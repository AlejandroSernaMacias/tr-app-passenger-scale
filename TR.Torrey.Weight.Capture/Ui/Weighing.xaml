<UserControl x:Class="TR.Torrey.Weight.Capture.Ui.Weighing"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:TR.Torrey.Weight.Capture.Converters"
             mc:Ignorable="d" 
             Style="{StaticResource StyleUC}">
    
    <UserControl.Resources>
        <local:StringToColorConverter x:Key="StringToColorConverter"/>
        <local:StatusToVisibilityConverter x:Key="StatusToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <Label Content="{Binding Title}" Style="{StaticResource ItemsFound}" />
            </Grid>
            <Grid Grid.Column="1">
                <Label Content="{Binding TotalSamples}" Style="{StaticResource ItemsFoundActive}"/>
            </Grid>
            <Grid Grid.Column="2">
                <Label Content="{Binding TotalWeight}" Style="{StaticResource ItemsFoundPending}"/>
            </Grid>

        </Grid>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0" >
                <!--<Label Content="{Binding ScalesFound}" Style="{StaticResource ItemsFound}"/>-->
                <StackPanel Orientation="Horizontal" Margin="10,10,10,0" HorizontalAlignment="Right">
                    <TextBlock Text="Online: " FontWeight="Bold" Foreground="Green" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding OnlineCount}" Foreground="Green" Margin="0,0,15,0"/>

                    <TextBlock Text="Offline: " FontWeight="Bold" Foreground="DarkRed" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding OfflineCount}" Foreground="DarkRed"/>
                </StackPanel>
            </Grid>
            <Grid Grid.Column="1">
            </Grid>

            <Border Grid.Column="2" Style="{StaticResource BorderTextBoxBlack}" Margin="10,0">
                <Button
                    Height="40"
                    Background="Transparent"
                    BorderThickness="0"
                    IsEnabled="{Binding DataContext.ControlsEnabled, RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}"
                    Style="{StaticResource MaterialDesignRaisedDarkButton}"
                    ToolTip="{Binding TxtReport}"
                    Command="{Binding ReportCommand}">
                    <TextBlock Text="{Binding TxtReport}" Style="{StaticResource TextBlockButton}"/>
                </Button>
            </Border>

        </Grid>

        <DataGrid Grid.Row="2"
          AutoGenerateColumns="False"
          CanUserAddRows="False"
          CanUserDeleteRows="False"
          ItemsSource="{Binding Scales}"
          Margin="10,50,10,10"
          Background="Transparent"
          BorderBrush="Transparent"
          BorderThickness="1"
          Style="{StaticResource MaterialDesignDataGrid}"
          IsReadOnly="True">

            <DataGrid.Resources>
                <!-- Encabezados -->
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#009c36"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="10"/>
                </Style>

                <!-- Filas -->
                <Style TargetType="DataGridRow">
                    <Setter Property="BorderBrush" Value="#414141"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsWeightUpdated}" Value="True">
                            <Setter Property="Background" Value="LightGreen"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn x:Name="HeaderScaleName"    Header="Báscula" Binding="{Binding vName}" IsReadOnly="True" Foreground="#414141" Width="*"/>
                <DataGridTextColumn x:Name="HeaderIp"           Header="IP" Binding="{Binding vIp}" IsReadOnly="True" Foreground="#414141" Width="*"/>
                <DataGridTextColumn x:Name="HeaderMinWeight"    Header="Min. Peso" Binding="{Binding fMinWeight}" IsReadOnly="True" Foreground="#414141" Width="*"/>
                <DataGridTextColumn x:Name="HeaderMinTime"      Header="Min. Tiempo" Binding="{Binding iMinTime}" IsReadOnly="True" Foreground="#414141" Width="*"/>

                <!-- Estado con color y texto -->
                <DataGridTemplateColumn x:Name="HeaderScaleStatus" Header="Estado" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Ellipse Width="12" Height="12" Margin="0,0,5,0">
                                    <Ellipse.Fill>
                                        <SolidColorBrush Color="{Binding vStatusColor, Converter={StaticResource StringToColorConverter}}"/>
                                    </Ellipse.Fill>
                                </Ellipse>
                                <TextBlock Text="{Binding vStatusScale}" Foreground="#414141" FontWeight="Bold"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Estado con color y texto -->
                <DataGridTemplateColumn x:Name="HeaderScaleReconect" Header="Accion" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Reconectar"
                                        Width="90"
                                        Margin="10,0,0,0"
                                        Command="{Binding DataContext.ReconectarCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Visibility="{Binding iStatus, Converter={StaticResource StatusToVisibilityConverter}}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn x:Name="HeaderSamples" Header="Muestras" Binding="{Binding iSamples}" IsReadOnly="True" Foreground="#414141" FontWeight="Bold" Width="*"/>
                <DataGridTextColumn x:Name="HeaderWeight"  Header="Peso" Binding="{Binding fWeight}" IsReadOnly="True" Foreground="#414141" FontWeight="Bold" Width="*"/>
                <DataGridTextColumn x:Name="HeaderTotal"   Header="Total" Binding="{Binding fTotal}" IsReadOnly="True" Foreground="#414141" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>


    </Grid>
</UserControl>
